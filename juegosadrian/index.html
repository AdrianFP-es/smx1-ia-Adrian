<!doctype html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <title>Pong senzill</title>
  <style>
    html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif;background:#111;color:#fff}
    .wrap{height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px}
    canvas{background:#050505;border:2px solid #333;display:block}
    .hud{display:flex;gap:24px;align-items:center;font-size:20px}
    .msg{position:absolute;top:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.6);padding:8px 14px;border-radius:6px}
    .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
    .win{background:rgba(0, 0, 0, 0.75);padding:20px 30px;border-radius:8px;pointer-events:auto;text-align:center}
    button{margin-top:10px;padding:8px 12px;border:none;border-radius:6px;background:#28a; color:#fff;cursor:pointer}
    .controls{display:flex;gap:20px;justify-content:center;margin:10px 0;flex-wrap:wrap}
    .color-group{display:flex;gap:8px;align-items:center}
    .color-group label{font-size:14px}
    input[type="color"]{width:40px;height:40px;border:none;cursor:pointer}
    .difficulty-group{display:flex;gap:8px;align-items:center}
    .difficulty-group label{font-size:14px}
    .difficulty-group select{padding:6px 8px;border:none;border-radius:4px;background:#333;color:#fff;cursor:pointer}
    button:hover{background:#1a6}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hud">
      <div>Jugador 1: <span id="scorePlayer">0</span></div>
      <div>Jugador 2: <span id="scoreOpponent">0</span></div>
    </div>

    <div class="controls">
      <div class="color-group">
        <label for="colorPlayer">Color Jugador 1:</label>
        <input type="color" id="colorPlayer" value="#ffffff">
      </div>
      <div class="color-group">
        <label for="colorOpponent">Color Jugador 2:</label>
        <input type="color" id="colorOpponent" value="#ffffff">
      </div>
      <div class="color-group">
        <label for="colorBall">Color Pilota:</label>
        <input type="color" id="colorBall" value="#ffffff">
      </div>
      <div class="difficulty-group">
        <label for="difficulty">Dificultat IA:</label>
        <select id="difficulty">
          <option value="easy">Fàcil</option>
          <option value="medium" selected>Mitjà</option>
          <option value="hard">Difícil</option>
        </select>
      </div>
      <div class="difficulty-group">
        <label for="explosion">Efecte Explosió:</label>
        <select id="explosion">
          <option value="particles" selected>Partícules</option>
          <option value="circle">Círculs Expandint</option>
          <option value="stars">Estrelles</option>
          <option value="none">Cap</option>
        </select>
      </div>
    </div>

    <div style="position:relative">
      <canvas id="game" width="800" height="500"></canvas>
      <div id="overlay" class="overlay" style="display:none">
        <div class="win" id="winBox">
          <div id="winText"></div>
          <button id="restartBtn">Reinicia (Espai)</button>
        </div>
      </div>
    </div>
    <div class="msg">Mou la raqueta amb Fletxa amunt / Fletxa avall. El primer que faci 5 punts guanya</div>
  </div>

  <script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  const scorePlayerEl = document.getElementById('scorePlayer');
  const scoreOpponentEl = document.getElementById('scoreOpponent');
  const overlay = document.getElementById('overlay');
  const winText = document.getElementById('winText');
  const restartBtn = document.getElementById('restartBtn');
  const colorPlayerInput = document.getElementById('colorPlayer');
  const colorOpponentInput = document.getElementById('colorOpponent');
  const colorBallInput = document.getElementById('colorBall');
  const difficultySelect = document.getElementById('difficulty');
  const explosionSelect = document.getElementById('explosion');

  const W = canvas.width, H = canvas.height;

  const paddle = {
    w: 12,
    h: 90,
    speed: 6
  };

  const player = { x: 20, y: (H - paddle.h)/2 };
  const opponent = { x: W - 20 - paddle.w, y: (H - paddle.h)/2, speed: 4 };

  let ball = {
    x: W/2,
    y: H/2,
    r: 8,
    vx: 5 * (Math.random() < 0.5 ? 1 : -1),
    vy: 3 * (Math.random() < 0.5 ? 1 : -1)
  };

  let up = false, down = false;
  let scorePlayer = 0, scoreOpponent = 0;
  let gameOver = false;
  const WIN_SCORE = 5;

  // colors
  let colorPlayer = '#ffffff';
  let colorOpponent = '#ffffff';
  let colorBall = '#ffffff';

  // difficulty settings
  let difficulty = 'medium';
  let aiSpeed = 4;
  let aiAccuracy = 6; // margin of error

  // explosion effect
  let explosionType = 'particles';
  let particles = [];

  class Particle {
    constructor(x, y, vx, vy, color) {
      this.x = x;
      this.y = y;
      this.vx = vx;
      this.vy = vy;
      this.color = color;
      this.life = 1;
    }
    update() {
      this.x += this.vx;
      this.y += this.vy;
      this.vy += 0.1; // gravity
      this.life -= 0.02;
    }
    draw(ctx) {
      ctx.globalAlpha = this.life;
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
      ctx.fill();
      ctx.globalAlpha = 1;
    }
  }

  class ExpandingCircle {
    constructor(x, y, color) {
      this.x = x;
      this.y = y;
      this.radius = 0;
      this.maxRadius = 60;
      this.color = color;
      this.life = 1;
    }
    update() {
      this.radius += 3;
      this.life -= 0.03;
    }
    draw(ctx) {
      ctx.globalAlpha = this.life;
      ctx.strokeStyle = this.color;
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.stroke();
      ctx.globalAlpha = 1;
    }
  }

  class Star {
    constructor(x, y, color) {
      this.x = x;
      this.y = y;
      this.color = color;
      this.angle = Math.random() * Math.PI * 2;
      this.speed = 2 + Math.random() * 3;
      this.life = 1;
    }
    update() {
      this.x += Math.cos(this.angle) * this.speed;
      this.y += Math.sin(this.angle) * this.speed;
      this.life -= 0.02;
    }
    draw(ctx) {
      ctx.globalAlpha = this.life;
      ctx.fillStyle = this.color;
      this.drawStar(ctx, this.x, this.y, 5, 8, 4);
      ctx.globalAlpha = 1;
    }
    drawStar(ctx, x, y, spikes, outer, inner) {
      let rot = Math.PI / 2;
      let step = Math.PI / spikes;
      ctx.beginPath();
      ctx.moveTo(x, y - outer);
      for (let i = 0; i < spikes * 2; i++) {
        let r = (i & 1) === 0 ? outer : inner;
        ctx.lineTo(x + Math.cos(i * step + rot) * r, y + Math.sin(i * step + rot) * r);
      }
      ctx.closePath();
      ctx.fill();
    }
  }

  function createExplosion(x, y, color) {
    if(explosionType === 'particles') {
      for(let i = 0; i < 12; i++) {
        const angle = (i / 12) * Math.PI * 2;
        const vx = Math.cos(angle) * 4;
        const vy = Math.sin(angle) * 4;
        particles.push(new Particle(x, y, vx, vy, color));
      }
    } else if(explosionType === 'circle') {
      particles.push(new ExpandingCircle(x, y, color));
    } else if(explosionType === 'stars') {
      for(let i = 0; i < 8; i++) {
        particles.push(new Star(x, y, color));
      }
    }
  }

  function updateParticles() {
    particles = particles.filter(p => p.life > 0);
    particles.forEach(p => p.update());
  }

  function drawParticles(ctx) {
    particles.forEach(p => p.draw(ctx));
  }

  function setDifficulty(level){
    difficulty = level;
    switch(level){
      case 'easy':
        aiSpeed = 2.5;
        aiAccuracy = 20;
        break;
      case 'medium':
        aiSpeed = 4;
        aiAccuracy = 6;
        break;
      case 'hard':
        aiSpeed = 6;
        aiAccuracy = 2;
        break;
    }
    opponent.speed = aiSpeed;
  }

  function resetBall(direction = 0){
    ball.x = W/2;
    ball.y = H/2;
    const angle = (Math.random() * 0.6 - 0.3);
    const speed = 5;
    if(direction === 0){
      ball.vx = speed * (Math.random() < 0.5 ? 1 : -1);
    } else {
      ball.vx = speed * direction;
    }
    ball.vy = speed * Math.tan(angle);
  }

  function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

  function update(){
    if(gameOver) return;

    if(up) player.y -= paddle.speed;
    if(down) player.y += paddle.speed;
    player.y = clamp(player.y, 0, H - paddle.h);

    // AI with difficulty
    const aiTarget = ball.y - (paddle.h/2);
    const aiMargin = aiAccuracy;
    if(opponent.y + paddle.h/2 < ball.y - aiMargin) opponent.y += aiSpeed;
    else if(opponent.y + paddle.h/2 > ball.y + aiMargin) opponent.y -= aiSpeed;
    opponent.y = clamp(opponent.y, 0, H - paddle.h);

    ball.x += ball.vx;
    ball.y += ball.vy;

    if(ball.y - ball.r <= 0){
      ball.y = ball.r;
      ball.vy *= -1;
    } else if(ball.y + ball.r >= H){
      ball.y = H - ball.r;
      ball.vy *= -1;
    }

    if(ball.x - ball.r <= player.x + paddle.w){
      if(ball.y >= player.y && ball.y <= player.y + paddle.h){
        ball.x = player.x + paddle.w + ball.r;
        reflectFromPaddle(player);
      }
    }
    if(ball.x + ball.r >= opponent.x){
      if(ball.y >= opponent.y && ball.y <= opponent.y + paddle.h){
        ball.x = opponent.x - ball.r;
        reflectFromPaddle(opponent);
      }
    }

    if(ball.x + ball.r < 0){
      scoreOpponent++;
      updateScore();
      createExplosion(ball.x, ball.y, colorBall);
      if(scoreOpponent >= WIN_SCORE) endGame('Jugador 2');
      else resetBall(1);
    } else if(ball.x - ball.r > W){
      scorePlayer++;
      updateScore();
      createExplosion(ball.x, ball.y, colorBall);
      if(scorePlayer >= WIN_SCORE) endGame('Jugador 1');
      else resetBall(-1);
    }
  }

  function reflectFromPaddle(p){
    ball.vx *= -1.05;
    const hitPos = (ball.y - p.y) / paddle.h;
    const offset = (hitPos - 0.5) * 8;
    ball.vy += offset;
    const maxSpeed = 12;
    ball.vx = clamp(ball.vx, -maxSpeed, maxSpeed);
    ball.vy = clamp(ball.vy, -maxSpeed, maxSpeed);
  }

  function updateScore(){
    scorePlayerEl.textContent = scorePlayer;
    scoreOpponentEl.textContent = scoreOpponent;
  }

  function endGame(winner){
    gameOver = true;
    winText.textContent = winner + ' ha guanyat!';
    overlay.style.display = 'flex';
  }

  function draw(){
    ctx.clearRect(0,0,W,H);

    ctx.fillStyle = '#444';
    for(let y=10;y<H;y+=30){
      ctx.fillRect(W/2 - 2, y, 4, 18);
    }

    ctx.fillStyle = colorPlayer;
    ctx.fillRect(player.x, player.y, paddle.w, paddle.h);
    
    ctx.fillStyle = colorOpponent;
    ctx.fillRect(opponent.x, opponent.y, paddle.w, paddle.h);

    ctx.fillStyle = colorBall;
    ctx.beginPath();
    ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2);
    ctx.fill();

    // draw particles
    drawParticles(ctx);

    ctx.fillStyle = '#bbb';
    ctx.font = '20px monospace';
    ctx.textAlign = 'center';
    ctx.fillText(scorePlayer + '  -  ' + scoreOpponent, W/2, 28);
  }

  function loop(){
    updateParticles();
    update();
    draw();
    if(!gameOver) requestAnimationFrame(loop);
  }

  window.addEventListener('keydown', e => {
    if(e.key === 'ArrowUp') up = true;
    if(e.key === 'ArrowDown') down = true;
    if(e.code === 'Space'){
      if(gameOver) restart();
    }
  });

  window.addEventListener('keyup', e => {
    if(e.key === 'ArrowUp') up = false;
    if(e.key === 'ArrowDown') down = false;
  });

  restartBtn.addEventListener('click', restart);

  // color pickers
  colorPlayerInput.addEventListener('change', e => {
    colorPlayer = e.target.value;
  });
  colorOpponentInput.addEventListener('change', e => {
    colorOpponent = e.target.value;
  });
  colorBallInput.addEventListener('change', e => {
    colorBall = e.target.value;
  });

  // difficulty selector
  difficultySelect.addEventListener('change', e => {
    setDifficulty(e.target.value);
  });

  // explosion selector
  explosionSelect.addEventListener('change', e => {
    explosionType = e.target.value;
  });

  function restart(){
    scorePlayer = 0;
    scoreOpponent = 0;
    updateScore();
    gameOver = false;
    overlay.style.display = 'none';
    resetBall(Math.random() < 0.5 ? 1 : -1);
    player.y = (H - paddle.h)/2;
    opponent.y = (H - paddle.h)/2;
    requestAnimationFrame(loop);
  }

  // init
  setDifficulty('medium');
  updateScore();
  resetBall(Math.random() < 0.5 ? 1 : -1);
  requestAnimationFrame(loop);
  </script>
</body>
</html>