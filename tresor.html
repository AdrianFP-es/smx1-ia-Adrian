<!doctype html>
<html lang="ca">
<head>
  <meta charset="utf-8" />
  <title>Joc del Tresor</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background: #1a1a1a;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    canvas {
      background: #2d2d2d;
      border: 3px solid #4a4a4a;
      display: block;
    }
    .hud {
      font-size: 18px;
      display: flex;
      gap: 30px;
    }
    .msg {
      font-size: 14px;
      color: #aaa;
      text-align: center;
    }
    .overlay {
      position: absolute;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.8);
      pointer-events: auto;
    }
    .win-box {
      background: rgba(0, 0, 0, 0.9);
      padding: 30px 40px;
      border-radius: 8px;
      text-align: center;
      border: 2px solid #4a4;
    }
    .win-box h1 {
      margin: 0 0 15px 0;
      font-size: 32px;
      color: #4a4;
    }
    .win-box p {
      margin: 10px 0;
      font-size: 16px;
    }
    button {
      margin-top: 15px;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: #4a4;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #6d6;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üó∫Ô∏è Joc del Tresor</h1>
    <div class="hud">
      <div>Moviments: <span id="moves">0</span></div>
      <div>Temps: <span id="time">0</span>s</div>
    </div>
    <div style="position: relative;">
      <canvas id="game" width="800" height="600"></canvas>
      <div id="overlay" class="overlay">
        <div class="win-box">
          <h1>üéâ Has guanyat!</h1>
          <p>Moviments: <span id="finalMoves">0</span></p>
          <p>Temps: <span id="finalTime">0</span>s</p>
          <button id="restartBtn">Juga de nou (Espai)</button>
        </div>
      </div>
    </div>
    <div class="msg">Mou el personatge amb les Fletxes ‚¨ÜÔ∏è‚¨áÔ∏è‚¨ÖÔ∏è‚û°Ô∏è i troba el tresor üíé</div>
  </div>

  <script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const overlay = document.getElementById('overlay');
  const restartBtn = document.getElementById('restartBtn');
  const movesEl = document.getElementById('moves');
  const timeEl = document.getElementById('time');
  const finalMovesEl = document.getElementById('finalMoves');
  const finalTimeEl = document.getElementById('finalTime');

  const W = canvas.width;
  const H = canvas.height;

  // Personatge
  const player = {
    x: W / 2,
    y: H / 2,
    w: 30,
    h: 30,
    speed: 5,
    color: '#4a9eff'
  };

  // Tresor
  let treasure = {
    x: 0,
    y: 0,
    w: 30,
    h: 30,
    color: '#ffd700'
  };

  // Controls
  let keys = {};

  // Game state
  let moves = 0;
  let gameTime = 0;
  let gameOver = false;
  let startTime = Date.now();

  function spawnTreasure() {
    treasure.x = Math.random() * (W - treasure.w);
    treasure.y = Math.random() * (H - treasure.h);
  }

  function distance(x1, y1, x2, y2) {
    const dx = x2 - x1;
    const dy = y2 - y1;
    return Math.sqrt(dx * dx + dy * dy);
  }

  function checkCollision() {
    const playerCenterX = player.x + player.w / 2;
    const playerCenterY = player.y + player.h / 2;
    const treasureCenterX = treasure.x + treasure.w / 2;
    const treasureCenterY = treasure.y + treasure.h / 2;

    const dist = distance(playerCenterX, playerCenterY, treasureCenterX, treasureCenterY);
    return dist < (player.w / 2 + treasure.w / 2);
  }

  function update() {
    if (gameOver) return;

    let moved = false;

    // Moviment
    if (keys['ArrowUp'] || keys['w'] || keys['W']) {
      player.y = Math.max(0, player.y - player.speed);
      moved = true;
    }
    if (keys['ArrowDown'] || keys['s'] || keys['S']) {
      player.y = Math.min(H - player.h, player.y + player.speed);
      moved = true;
    }
    if (keys['ArrowLeft'] || keys['a'] || keys['A']) {
      player.x = Math.max(0, player.x - player.speed);
      moved = true;
    }
    if (keys['ArrowRight'] || keys['d'] || keys['D']) {
      player.x = Math.min(W - player.w, player.x + player.speed);
      moved = true;
    }

    if (moved) {
      moves++;
      movesEl.textContent = moves;
    }

    // Temps
    gameTime = Math.floor((Date.now() - startTime) / 1000);
    timeEl.textContent = gameTime;

    // Col¬∑lisi√≥ amb tresor
    if (checkCollision()) {
      endGame();
    }
  }

  function draw() {
    // Fons
    ctx.fillStyle = '#2d2d2d';
    ctx.fillRect(0, 0, W, H);

    // Graella
    ctx.strokeStyle = '#444';
    ctx.lineWidth = 1;
    for (let i = 0; i <= W; i += 50) {
      ctx.beginPath();
      ctx.moveTo(i, 0);
      ctx.lineTo(i, H);
      ctx.stroke();
    }
    for (let i = 0; i <= H; i += 50) {
      ctx.beginPath();
      ctx.moveTo(0, i);
      ctx.lineTo(W, i);
      ctx.stroke();
    }

    // Personatge
    ctx.fillStyle = player.color;
    ctx.fillRect(player.x, player.y, player.w, player.h);
    ctx.fillStyle = '#fff';
    ctx.font = 'bold 16px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('üë§', player.x + player.w / 2, player.y + player.h / 2);

    // Tresor
    ctx.fillStyle = treasure.color;
    ctx.fillRect(treasure.x, treasure.y, treasure.w, treasure.h);
    ctx.fillStyle = '#000';
    ctx.font = 'bold 20px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText('üíé', treasure.x + treasure.w / 2, treasure.y + treasure.h / 2);
  }

  function loop() {
    update();
    draw();
    if (!gameOver) requestAnimationFrame(loop);
  }

  function endGame() {
    gameOver = true;
    finalMovesEl.textContent = moves;
    finalTimeEl.textContent = gameTime;
    overlay.style.display = 'flex';
  }

  // Keyboard input
  window.addEventListener('keydown', e => {
    keys[e.key] = true;
    if (e.code === 'Space' && gameOver) {
      restart();
    }
  });

  window.addEventListener('keyup', e => {
    keys[e.key] = false;
  });

  restartBtn.addEventListener('click', restart);

  function restart() {
    player.x = W / 2;
    player.y = H / 2;
    moves = 0;
    gameTime = 0;
    gameOver = false;
    startTime = Date.now();
    movesEl.textContent = moves;
    timeEl.textContent = gameTime;
    overlay.style.display = 'none';
    spawnTreasure();
    requestAnimationFrame(loop);
  }

  // Init
  spawnTreasure();
  requestAnimationFrame(loop);
  </script>
</body>
</html>